// Timer Variables
let countdown;
let isPaused = false;
let remainingTime = 0;
let activeButton = null;

// DOM Elements
const timerDisplay = document.getElementById('timer');
const timerButtons = document.querySelectorAll('.timer-btn, .big-button, .huge-button');

// Timer Functions
function startTimer(seconds, button) {
  // Pause/resume if same button clicked
  if (button === activeButton && countdown) {
    togglePause();
    return;
  }

  // New timer
  resetTimer();
  remainingTime = seconds * 1000;
  activeButton = button;
  document.body.classList.remove('red');
  
  countdown = setInterval(updateTimer, 10);
}

function updateTimer() {
  if (remainingTime <= 0) {
    endTimer();
    return;
  }
  
  remainingTime -= 10;
  timerDisplay.textContent = formatTime(remainingTime);
}

function formatTime(ms) {
  const seconds = (ms / 1000).toFixed(2);
  return seconds.padStart(5, '0'); // Ensures format like "05.00"
}

function togglePause() {
  if (isPaused) {
    countdown = setInterval(updateTimer, 10);
    isPaused = false;
  } else {
    clearInterval(countdown);
    isPaused = true;
  }
}

function endTimer() {
  clearInterval(countdown);
  timerDisplay.textContent = '00.00';
  document.body.classList.add('red');
  activeButton = null;
}

function resetTimer() {
  clearInterval(countdown);
  isPaused = false;
  document.body.classList.remove('red');
}

// Event Listeners
function init() {
  // Timer buttons
  timerButtons.forEach(button => {
    button.addEventListener('click', () => {
      const seconds = parseInt(button.dataset.time);
      startTimer(seconds, button);
    });
  });

  // Jar counters
  document.querySelectorAll('.counter-btn').forEach(button => {
    button.addEventListener('click', function() {
      const counterId = this.dataset.counter;
      const operation = this.dataset.operation;
      const counterElement = document.getElementById(counterId);
      let value = parseInt(counterElement.textContent) || 0;

      value = operation === 'plus' ? value + 1 : Math.max(0, value - 1);
      counterElement.textContent = value;
    });
  });
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
